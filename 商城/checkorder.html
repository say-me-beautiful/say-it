<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="css/order.css"/>
		<link rel="stylesheet" type="text/css" href="css/login_register.css"/>
	</head>
	<body>
	<div id="header-list">
		<a href="index.html"><i class="homelog"></i>美丽说首页</a>
		<div id="header-list-right">
			<a href="login.html" name="login" class="login">登录</a>
			<a href="register.html" name="register" class="register">注册</a>
			<a href="#" name="username" class="username1">liuzhaohuiemmmmmm</a>
			<a href="javascript:localStorage.clear();location.reload()" class="logout">退出</a>
			<a href="cart.html"><i class="cartlog"></i>购物车</a>
			<a href="order.html"><i class="orderlog"></i>我的订单</a>
		</div>
	</div>
	<div id="header-search">
		<a href="index.html"></a>
		<div id="search-box">
			<input id="search" type="text" placeholder="超短裙">
			<div id="search-button"><i></i></div>
		</div>
		<i></i>
	</div>
	<div class="Body">
		<div class="left-side">
			<dl>
				<dt>我的订单</dt>
				<dd><a href="#" style="color: #ff6699;">全部订单</a></dd>
				<dd><a href="#">待收货</a></dd>
				<dd><a href="#">待评价</a></dd>
				<dd><a href="#">退货</a></dd>
				<dd><a href="#">退款</a></dd>
				<dd><a href="#">订单回收站</a></dd>
			</dl>
			<dl>
				<dt>优惠特权</dt>
				<dd><a href="#">平台优惠券</a></dd>
				<dd><a href="#">店铺优惠券</a></dd>
			</dl>
			<dl>
				<dt><a href="#">我的足迹 </a></dt>
			</dl>
			<dl>
				<dt><a href="#">收货地址 </a></dt>
			</dl>
			<dl>
				<dt>账户管理</dt>
				<dd><a href="#">我的信息</a></dd>
				<dd><a href="#">我的头像</a></dd>
			</dl>
			<dl>
				<dt>安全中心</dt>
				<dd><a href="#">用户密码</a></dd>
				<dd><a href="#">支付密码</a></dd>
				<dd><a href="#">手机绑定</a></dd>
				<dd><a href="#">登录设备</a></dd>
			</dl>
		</div>
		<div class="right-side">
			<ul class="right-side-header">
				<li style="width:320px">商品</li>
				<li style="width:120px">单价(元)</li>
				<li style="width:80px">数量</li>
				<li style="width:112px">售后</li>
				<li style="width:128px">实付款</li>
				<li style="width:125px">交易状态</li>
				<li style="width:115px">操作</li>
			</ul>
			<ul id="order">
				
			</ul>
		</div>
	</div>
	<div id="footer" style="margin-top: 50px;"> 
			<div id="footer-nav">
				<div id="footer-dl">
					<dl style="margin-left:75px;">
						<dt>卖家帮助</dt>
						<dd><a href="#">新手指南</a></dd>
						<dd><a href="#">服务保障</a></dd>
						<dd><a href="#">常见问题</a></dd>
						<dd><a href="#">风险监测</a></dd>
					</dl>
					<dl>
						<dt>商家帮助</dt>
						<dd><a href="#">供货商招募</a></dd>
						<dd><a href="#">商家后台</a></dd>
					</dl>
					<dl>
						<dt>关于我们</dt>
						<dd><a href="#">关于美丽说</a></dd>
						<dd><a href="#">联系我们</a></dd>
					</dl>
					<dl class="follow-us">
						<dt>关注我们</dt>
						<dd><a href="#"><i></i>新浪微博</a></dd>
						<dd><a href="#"><i style="background-position:-28px 0;"></i>QQ空间</a></dd>
						<dd><a href="#"><i style="background-position:-56px 0;"></i>腾讯微博</a></dd>
					</dl>
				</div>
				<div id="footer-qr">
					<div style="margin-left:136px;">
						<h3>美丽说微信服务号</h3>
						<img src='img/fuwu.jpg'>
					</div>
					<div>
						<h3>美丽说客户端下载</h3>
						<img src='img/app.png'>
					</div>
				</div>
			</div>
			<div id="footer-copy">
				<p style="margin-top:10px;">Copyright ©2017 Meilishuo.com  电信与信息服务业务经营许可证100798号 经营性网站备案信息 </p>
				<p>京ICP备11031139号  京公网安备110108006045   客服电话：4000-800-577  文明办网文明上网举报电话：010-82615762  违法不良信息举报中心</p>
			</div>
			</div>
	<div id="hiddle3" style="display: none;">
		  	<div class="smallhiddle2">
		  	<div class="ku"><img src="img/kule.png" style="width:100px;height: 100px;"/></div>
		  	<p style="font-size: 15px;line-height: 40px;margin-top: 30px;">真的要取消吗？</p>
		  	<span class="yessa">是</span>
		  	<span class="nosa">否</span>
		  	</div>
		  </div>
</body>
	<script type="text/javascript">
		if(localStorage.username){
			var oUsername =  document.querySelector('a[name=username]');
			var oLogout = document.querySelector('.logout');
			oUsername.innerText = localStorage.username;
			oUsername.style.display = 'inline';
			oLogout.style.display = 'inline';
		}else{
			var oRegister = document.querySelector('.register');
			var oLogin = document.querySelector('.login');
			oRegister.style.display = 'inline';
			oLogin.style.display = 'inline';
		}
	</script>
	<script>
		var oHiddle3=document.querySelector('#hiddle3')
		var oYessa=document.querySelector('.yessa')
		var oNosa=document.querySelector('.nosa')
		var oSearchButton = document.querySelector('#search-button');
		var oSearchInput = document.querySelector('#search');
		oSearchButton.onclick=function(){
			location.href = 'commen.html?search_text=' + oSearchInput.value;
		}
		oSearchInput.onkeyup = function(event){
			if(event.keyCode === 13){
				location.href = 'commen.html?search_text=' + oSearchInput.value;
			}
		}
		function search(){
			location.href = 'commen.html?search_text=' + oSearchInput.value;}
		oSearchButton.addEventListener('click',search,false);
		oSearchInput.onkeyup = function(event){
			if(event.keyCode === 13){
				search();
			}
		}
		function search(){
			location.href = 'commen.html?search_text=' + oSearchInput.value;
		}
	</script>
	<script src="js/myajax.js"></script>
	<script type="text/javascript">
	
	var oOrder = document.querySelector('#order');
	myajax.get('http://h6.duchengjiu.top/shop/api_order.php', 
		{token: localStorage.token
	}, function(err, responseText) {
		var json = JSON.parse(responseText);
		var myDate=new Date();
		console.log(json);
		var data = json.data;
		if(data.length === 0) {
			oOrder.innerHTML = "<h3>您的订单为空</h3>";
			return;
		}
		for(var i = 0; i < data.length; i++) {
			var obj = data[1];
			//遍历商品列表，拼装HTML
			var goodsHTML = '';
			for(var j = 0; j < obj.goods_list.length; j++) {
				var goods = obj.goods_list[j];
				goodsHTML += `
			<div class="goods-head">订单编号:<span id="random" style="margin-left:20px;margin-right:200px">${obj.order_id}</span>成交时间：
			<span style="margin-left:20px">${(new Date()).toLocaleDateString() + " " + (new Date()).toLocaleTimeString()}
			</span>
			</div>
            <div class="goods-body">
              
              <div class="goods-body-goods" style="width:320px;text-align:left;">
              	<div style="width:80px;height:80px;margin-left:30px;margin-right:10px">
              		<a href="goods.html?goods_id=${obj.goods_id}"><img src="${goods.goods_thumb}" title="商品详情"></a>
              	</div>
              	<div style="width:180px;height:80px">${goods.goods_name}</div>
              </div>
              <div style="width:120px">${goods.goods_price}</div>
              <div style="width:80px">${goods.goods_number}</div>
              <div style="width:112px;border-right: 1px solid #ececec;"></div>
              <div style="width:128px;border-right: 1px solid #ececec;">${goods.goods_price * goods.goods_number}
              	<p>(全国包邮)</p>
              </div>
              <div style="width:125px;border-right: 1px solid #ececec;">
              <p>待付款</p>
              <a href="#">订单详情</a>
              </div>
              	
            	
            </div>
          `;
			}
			//一件商品的总价
			oOrder.innerHTML = `
                          <li class="order-li">
                             <div class="order-goods">
                            ${goodsHTML}
                           <div class="order-footer">
                           <div style="display:inline-block;width:600px">还剩0天23分59秒
                           <span data-id="${obj.order_id}" class="cancel-order" style="color:skyblue;margin-left:40px">取消订单</span>
                           </div>
                           <div>
                           <span style="margin-left:20px">总价:${obj.total_prices}元 </span>
                           <span style="margin-left:40px">等待付款</span>
                           <button name="pay" class="paybutton" style="margin-left:40px">付款</button>
                           </div>
                           </div>
                          </li>
                          `;
		}
	});
	oOrder.onclick = function(event) {
      event = event || window.event;
      var target = event.target || event.srcElement;
      
      if (target.className === 'cancel-order') {
      	oHiddle3.style.display="block";
        oYessa.onclick=function(){ 
        var order_id = target.dataset.id;
        var number=0;
        myajax.post('http://h6.duchengjiu.top/shop/api_order.php?token='+localStorage.token+'&status=delete', {order_id,number}, function(err, responseText) {
          var json = JSON.parse(responseText);
          if (json.code === 0) {
            var tr = target.parentNode.parentNode.parentNode;
            tr.parentNode.removeChild(tr);

          }
        });
        oHiddle3.style.display="none";
        }
       oNosa.onclick=function(){
       	oHiddle3.style.display="none";
       	return;
       }
      }
      if (target.name === 'pay') {
      	location.href="pay.html"
      }
    } 
</script>
</html>
